<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Gift Haul</title>
    <script src="https://cdn.tailwindcss.com"></script>
    

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Bebas+Neue&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            /* Фон останется красивым фоновым изображением TikTok */
            background-image: url('https://wallpapers-clan.com/wp-content/uploads/2020/09/tik-tok-logo-black-wallpaper-scaled.jpg');
            background-color: #000000;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            
            color: white;
        }
        /* Стили для главного заголовка */
        .neon-title {
            font-family: 'Bebas Neue', cursive;
            color: #ff4500;
            text-shadow: 0 0 5px #ff8c00, 0 0 15px #ff8c00, 0 0 30px #ff0000;
        }
        /* Стили для подзаголовка */
        .neon-subtitle {
            color: #c9a0ff;
            text-shadow: 0 0 3px #8a2be2, 0 0 10px #8a2be2;
        }
        /* Стили для кнопок "Add" и "Get Gifts" */
        .neon-button {
            box-shadow: 0 0 5px rgba(255, 69, 0, 0.7), 0 0 15px rgba(255, 69, 0, 0.5);
            transition: all 0.2s ease-in-out;
        }
        .neon-button:hover {
            box-shadow: 0 0 10px rgba(255, 69, 0, 1), 0 0 30px rgba(255, 69, 0, 0.7);
            transform: translateY(-1px);
        }
        /* Стили для плейсхолдеров, если картинка не загрузится */
        .gift-image-placeholder {
            background-color: rgba(10, 10, 30, 0.8); 
            box-shadow: inset 0 0 15px rgba(138, 43, 226, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.5rem;
            min-height: 200px;
        }
        /* Стили для самих изображений (ОБНОВЛЕНО: object-fit: contain) */
        .gift-image {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Изменено с 'cover' на 'contain' */
            display: block;
        }
        /* Стили для названий подарков с неоновым свечением */
        .gift-name-neon {
            font-family: 'Press Start 2P', cursive;
            color: #d1b5ff;
            text-shadow: 
                0 0 5px #ff00ff,
                0 0 10px #8a2be2,
                0 0 15px #4b0082;
            transition: text-shadow 0.3s ease-in-out;
            /* Меньший базовый размер шрифта для лучшей адаптации на мобильных */
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25; /* Для лучшего переноса строк */
        }
        /* Медиа-запрос для размера шрифта на средних экранах */
        @media (min-width: 640px) { /* sm */
            .gift-name-neon {
                font-size: 1.125rem; /* text-lg на sm и больше */
            }
        }
        
        /* Стили для бейджа корзины (оранжевый кружок) */
        .cart-badge {
            position: absolute;
            top: -5px; /* Сдвиг, чтобы быть над иконкой */
            right: -5px;
            background-color: #ff4500; /* Яркий оранжевый */
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            line-height: 1;
            padding: 4px 6px;
            border-radius: 9999px; /* Круглый */
            box-shadow: 0 0 5px #ff8c00;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; /* Плавный переход */
            transform: scale(1); /* Изначальный размер */
            will-change: opacity, transform; /* Подсказка браузеру для оптимизации (GPU acceleration) */
        }
        
        /* КЛАСС для скрытия */
        .cart-badge.is-empty {
            opacity: 0;
            pointer-events: none; /* Игнорируем клики, когда пуст */
            transform: scale(0.5); /* Эффект уменьшения */
        }

        /* Стили для новой иконки, чтобы она светилась */
        .neon-bag-icon {
            color: #8a2be2; /* Фиолетовый цвет */
            filter: drop-shadow(0 0 5px #8a2be2) drop-shadow(0 0 10px #4b0082);
            transition: color 0.2s;
        }

        /* --- СТИЛИ ДЛЯ КРУГЛЫХ КНОПОК КОЛИЧЕСТВА --- */
        .round-qty-button {
            width: 44px; /* Чуть больше для удобства нажатия на мобильных */
            height: 44px;
            border-radius: 9999px; /* full circle */
            background-color: #8a2be2; /* BlueViolet / Фиолетовый */
            color: white;
            font-weight: 900;
            font-size: 1.75rem; /* text-3xl для символов + / - */
            display: flex;
            align-items: center;
            justify-content: center;
            /* Неоновое свечение */
            box-shadow: 0 0 8px rgba(138, 43, 226, 0.8), 0 0 20px rgba(75, 0, 130, 0.6);
            transition: all 0.15s ease-in-out;
            border: 2px solid #c9a0ff; /* Светлая окантовка */
            cursor: pointer;
            flex-shrink: 0; /* Чтобы не сжимались в flex-контейнере */
        }
        .round-qty-button:hover {
            background-color: #9370db;
            box-shadow: 0 0 15px rgba(138, 43, 226, 1), 0 0 35px rgba(75, 0, 130, 0.8);
            transform: scale(1.05);
        }
        .round-qty-button:active {
             transform: scale(0.95);
             box-shadow: 0 0 5px rgba(138, 43, 226, 0.5);
        }

        /* Стиль для центрального счетчика */
        .qty-display {
            flex-grow: 1; /* Занимает оставшееся место */
            height: 44px; /* Совпадает с высотой кнопок */
            display: flex;
            align-items: center;
            justify-content: center;
            /* Фон с неоновым обрамлением */
            background-color: rgba(26, 26, 26, 0.9);
            box-shadow: inset 0 0 10px rgba(138, 43, 226, 0.4); 
            color: #d1b5ff; /* Светло-фиолетовый текст */
            font-size: 1.125rem; /* text-lg */
            font-weight: bold;
            letter-spacing: 0.1em;
            margin: 0 8px; /* Отступ между кнопками и счетчиком */
            border-radius: 8px; /* Немного скругленный */
            text-shadow: 0 0 5px #c9a0ff;
        }
        /* Увеличенный отступ для корректного отображения контролов */
        .gift-item-controls {
            padding: 4px 0; /* Небольшой вертикальный отступ */
        }
        
        /* Стили для модального окна ввода имени пользователя */
        .username-input {
            /* Фиолетовый фон, как на изображении */
            background-color: rgba(100, 50, 200, 0.3); 
            border: 2px solid #8a2be2; /* Фиолетовая рамка */
            color: white;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.5); /* Фиолетовое свечение */
            transition: box-shadow 0.2s;
        }

        .username-input:focus {
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8), 0 0 30px rgba(75, 0, 130, 0.7);
        }

        .neon-purple-button {
            background-color: #8a2be2; /* Blue Violet / Фиолетовый */
            color: white;
            font-weight: bold;
            box-shadow: 0 0 10px #8a2be2, 0 0 20px #4b0082;
            transition: all 0.2s ease-in-out;
        }

        .neon-purple-button:hover {
            background-color: #9370db;
            box-shadow: 0 0 15px #8a2be2, 0 0 30px #4b0082;
            transform: translateY(-1px);
        }
        
        /* НОВЫЙ СТИЛЬ: Размытый фон для модальных окон */
        .modal-backdrop-blur {
            /* Черный с высокой прозрачностью */
            background-color: rgba(0, 0, 0, 0.7); 
            /* Применяем сильное размытие */
            backdrop-filter: blur(10px); 
            /* Добавлено для совместимости с -webkit- */
            -webkit-backdrop-filter: blur(10px);
        }

        /* Стили для Canvas Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Позволяет кликам проходить сквозь канвас */
            z-index: 1000; /* Выше всего */
        }
        
        /* Стили для галочки подтверждения */
        .success-checkmark-icon {
            color: #00ffff; /* Светло-голубой/циан */
            filter: drop-shadow(0 0 5px #00ffff) drop-shadow(0 0 15px #00cccc);
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="min-h-screen">
    
    <!-- CANVAS для анимации Confetti -->
    <canvas id="confetti-canvas" style="display: none;"></canvas>

    <div class="max-w-xl mx-auto p-4 pt-10" id="main-content-container">
        
        <header class="text-center mb-10" id="app-header">
            <h1 class="neon-title text-5xl sm:text-6xl font-extrabold tracking-wider mb-2 uppercase">
                TIKTOK GIFT
            </h1>
            <p class="neon-subtitle text-base sm:text-lg font-semibold tracking-wide">
                Your Halloween & Black Friday Haul!
            </p>
        </header>

        <main id="gift-grid" class="grid grid-cols-2 gap-4">
            
            <script>
                // Объект для хранения состояния корзины: { itemName: quantity }
                let cartState = {};
                let totalItems = 0;
                
                // Глобальные переменные для Confetti
                let confettiCanvas = null;
                let confettiContext = null;
                let particles = [];
                let animationFrameId = null;

                const COLORS = [
                    '#ff4500', // Оранжевый (TikTok)
                    '#8a2be2', // Фиолетовый (Неон)
                    '#ff00ff', // Фуксия (Неон)
                    '#00ffff', // Голубой (Неон)
                    '#ffffff'  // Белый
                ];

                // Класс частицы конфетти
                class Particle {
                    constructor(x, y, radius, color, velocity) {
                        this.x = x;
                        this.y = y;
                        this.radius = radius;
                        this.color = color;
                        this.velocity = velocity;
                        this.gravity = 0.5;
                        this.rotation = Math.random() * 360;
                        this.angularVelocity = Math.random() * 0.2 - 0.1;
                    }

                    draw() {
                        confettiContext.save();
                        confettiContext.translate(this.x, this.y);
                        confettiContext.rotate(this.rotation * Math.PI / 180);
                        confettiContext.fillStyle = this.color;
                        confettiContext.fillRect(-this.radius / 2, -this.radius / 2, this.radius, this.radius);
                        confettiContext.restore();
                    }

                    update() {
                        this.velocity.y += this.gravity;
                        this.x += this.velocity.x;
                        this.y += this.velocity.y;
                        this.rotation += this.angularVelocity * 10;
                        
                        // Плавное затухание (уменьшаем размер)
                        this.radius *= 0.99; 
                        this.draw();
                    }
                }

                // Запуск анимации конфетти
                const startConfetti = () => {
                    confettiCanvas = document.getElementById('confetti-canvas');
                    confettiContext = confettiCanvas.getContext('2d');
                    confettiCanvas.style.display = 'block';
                    
                    // Устанавливаем размер канваса на размер окна
                    confettiCanvas.width = window.innerWidth;
                    confettiCanvas.height = window.innerHeight;
                    
                    particles = [];
                    
                    // Точка запуска (центр экрана)
                    const x = confettiCanvas.width / 2;
                    const y = confettiCanvas.height / 2;
                    
                    // Создаем 150-200 частиц
                    for (let i = 0; i < 180; i++) {
                        const radius = Math.random() * 10 + 5;
                        const color = COLORS[Math.floor(Math.random() * COLORS.length)];
                        
                        // Запускаем из центра в случайных направлениях
                        const angle = Math.random() * Math.PI * 2;
                        const speed = Math.random() * 15 + 10; 
                        
                        const velocity = {
                            x: Math.cos(angle) * speed,
                            y: Math.sin(angle) * speed - 15 // Чтобы частицы сначала летели вверх
                        };
                        
                        particles.push(new Particle(x, y, radius, color, velocity));
                    }
                    
                    // Запускаем цикл анимации
                    animateConfetti();
                };

                // Цикл анимации
                const animateConfetti = () => {
                    // Очистка канваса
                    confettiContext.fillStyle = 'rgba(0, 0, 0, 0.0)';
                    confettiContext.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

                    // Обновление и отрисовка частиц
                    for (let i = particles.length - 1; i >= 0; i--) {
                        particles[i].update();
                        
                        // Удаляем частицы, которые стали слишком маленькими или улетели за экран
                        if (particles[i].radius < 0.5 || particles[i].y > confettiCanvas.height) {
                            particles.splice(i, 1);
                        }
                    }

                    // Продолжаем анимацию, если есть частицы
                    if (particles.length > 0) {
                        animationFrameId = requestAnimationFrame(animateConfetti);
                    } else {
                        // Останавливаем и скрываем канвас, когда анимация закончится
                        stopConfetti();
                    }
                };

                // Остановка анимации
                const stopConfetti = () => {
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    if (confettiCanvas) {
                        confettiCanvas.style.display = 'none';
                        confettiContext.clearRect(0, 0, confettiCanvas.width, confettiContext.height);
                    }
                };
                
                // Пересчет общего количества и обновления футера
                const renderCartTotal = () => {
                    // *** ИСПРАВЛЕНИЕ: Убедиться, что cartState определен, если вызывается вне add/change handler ***
                    if (typeof cartState === 'undefined' || cartState === null) {
                        cartState = {};
                    }

                    totalItems = Object.values(cartState).reduce((sum, current) => sum + current, 0);
                    
                    // Обновление цифры в иконке
                    const totalCountElement = document.getElementById('total-item-count');
                    if (totalCountElement) {
                        totalCountElement.textContent = totalItems;
                        
                        // ЛОГИКА: используем класс is-empty для управления видимостью через CSS
                        if (totalItems > 0) {
                            totalCountElement.classList.remove('is-empty');
                        } else {
                            totalCountElement.classList.add('is-empty');
                        }
                    }
                };

                // Функция для рендеринга элементов управления количеством ( –, 1, + )
                const renderQuantityControls = (itemName, quantity) => {
                    // Создаем контейнер для счетчика
                    const controls = document.createElement('div');
                    
                    // Используем justify-center и flex для нового макета
                    controls.className = 'flex items-center w-full gift-item-controls';

                    controls.innerHTML = `
                        <button 
                            id="minus-${itemName.replace(/\s/g, '-')}"
                            class="round-qty-button"
                            onclick="handleQuantityChange('${itemName}', -1)">
                            –
                        </button>
                        <span class="qty-display">
                            ${quantity}
                        </span>
                        <button 
                            id="plus-${itemName.replace(/\s/g, '-')}"
                            class="round-qty-button"
                            onclick="handleQuantityChange('${itemName}', 1)">
                            +
                        </button>
                    `;
                    return controls;
                };

                // Функция для рендеринга кнопки "Add"
                const renderAddButton = (itemName) => {
                    const button = document.createElement('button');
                    button.setAttribute('onclick', `handleAdd('${itemName}')`);
                    button.className = 'neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50';
                    button.textContent = 'Add';
                    return button;
                };

                // Перерисовывает элемент управления для конкретного подарка
                const updateGiftControl = (itemName, quantity) => {
                    const containerId = `controls-${itemName.replace(/\s/g, '-')}`;
                    const container = document.getElementById(containerId);
                    
                    if (!container) return; 

                    container.innerHTML = '';
                    
                    if (quantity > 0) {
                        container.appendChild(renderQuantityControls(itemName, quantity));
                    } else {
                        container.appendChild(renderAddButton(itemName));
                    }
                };
                
                // Обработчик нажатия на "Add" (устанавливает количество в 1)
                const handleAdd = (itemName) => {
                    handleQuantityChange(itemName, 1);
                };

                // Обработчик изменения количества (+ / –)
                const handleQuantityChange = (itemName, delta) => {
                    let currentQuantity = cartState[itemName] || 0;
                    let newQuantity = currentQuantity + delta;
                    
                    if (newQuantity < 0) {
                        newQuantity = 0;
                    }
                    
                    cartState[itemName] = newQuantity;
                    
                    // Если количество стало 0, удаляем из состояния
                    if (newQuantity === 0) {
                        delete cartState[itemName];
                    }

                    updateGiftControl(itemName, newQuantity);
                    renderCartTotal();
                };


                // --- ЛОГИКА СКРЫТИЯ UI ---
                const resetUI = () => {
                    const header = document.getElementById('app-header');
                    const mainContent = document.getElementById('gift-grid');
                    const footer = document.getElementById('app-footer');
                    
                    if (header) header.style.display = 'none';
                    if (mainContent) mainContent.style.display = 'none';
                    if (footer) footer.style.display = 'none';
                };
                // --- КОНЕЦ ЛОГИКИ СКРЫТИЯ UI ---


                // --- ЛОГИКА МОДАЛЬНЫХ ОКОН ---

                const closeModal = (id) => {
                    const modal = document.getElementById(id);
                    if (modal) {
                        modal.remove();
                    }
                    // Важно: останавливаем конфетти при закрытии любого модального окна
                    stopConfetti(); 
                    
                    // *** НОВОЕ: Если закрывается модальное окно подтверждения, сбрасываем UI и корзину ***
                    if (id === 'confirmation-modal') {
                        // Скрываем все элементы UI
                        resetUI(); 
                        // Очищаем корзину, чтобы при перезагрузке начать заново (если это одноразовая акция)
                        cartState = {};
                        renderCartTotal(); 
                    }
                }
                
                // 1. Модальное окно пустой корзины
                const showEmptyCartModal = () => {
                    const modalHtml = `
                        <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop-blur" id="empty-cart-modal">
                            <div class="bg-gray-900/90 rounded-xl p-6 w-full max-w-sm border border-purple-700 shadow-2xl shadow-purple-900/70 text-center">
                                <h3 class="text-2xl neon-title mb-4 pb-2">Корзина пуста!</h3>
                                <p class="text-gray-300 mb-6">Пожалуйста, добавьте хотя бы один подарок, чтобы продолжить.</p>
                                <button onclick="closeModal('empty-cart-modal')"
                                        class="neon-button w-full py-3 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500">
                                    Понятно
                                </button>
                            </div>
                        </div>
                    `;
                    let existingModal = document.getElementById('empty-cart-modal');
                    if (existingModal) { existingModal.remove(); }
                    
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = modalHtml;
                    document.body.appendChild(tempDiv.firstElementChild);
                };
                
                // 2. Модальное окно ввода имени пользователя (соответствует изображению)
                const showUsernameModal = () => {
                    const modalHtml = `
                        <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop-blur" id="username-modal">
                            <div class="bg-gray-900/90 rounded-xl p-8 w-full max-w-sm border border-purple-700 shadow-2xl shadow-purple-900/70 text-center">
                                
                                <h3 class="text-3xl font-extrabold mb-8" style="color: #d1b5ff; text-shadow: 0 0 8px #d1b5ff;">
                                    Enter Your Name
                                </h3>
                                
                                <div class="text-left mb-6">
                                    <label for="tiktok-username" class="block text-purple-300 font-semibold mb-2">
                                        Your TikTok Username:
                                    </label>
                                    <input type="text" id="tiktok-username" 
                                           placeholder="e.g., @spookygifter" 
                                           class="username-input w-full p-3 rounded-lg text-lg focus:outline-none">
                                </div>

                                <button id="submit-username-btn" 
                                        class="neon-purple-button w-full py-3 rounded-lg text-xl uppercase mb-4">
                                    Submit
                                </button>
                                
                                <button onclick="closeModal('username-modal')"
                                        class="w-full text-purple-400 font-semibold hover:text-white transition duration-200">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    `;
                    
                    let existingModal = document.getElementById('username-modal');
                    if (existingModal) { existingModal.remove(); }
                    
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = modalHtml;

                    // Получаем корневой элемент и добавляем его в DOM
                    const modalRoot = tempDiv.firstElementChild;
                    document.body.appendChild(modalRoot);

                    // Ищем кнопку submit внутри корневого элемента для надежности
                    const submitButton = modalRoot.querySelector('#submit-username-btn');

                    if (submitButton) {
                         // Добавляем обработчик для кнопки Submit
                        submitButton.onclick = () => {
                            const username = document.getElementById('tiktok-username').value.trim();
                            if (username) {
                                // Показываем модальное окно подтверждения
                                closeModal('username-modal');
                                showConfirmationModal(username);
                            } else {
                                // Показываем модальное окно ошибки
                                showErrorModal('Пожалуйста, введите имя пользователя TikTok.');
                            }
                        };
                    } else {
                        console.error("Кнопка 'Submit' не найдена в модальном окне.");
                    }
                };

                // 3. Вспомогательное модальное окно для подтверждения - ОБНОВЛЕНО
                const showConfirmationModal = (username) => {
                    // *** ЗАПУСК АНИМАЦИИ КОНФЕТТИ ***
                    startConfetti(); 

                    const modalHtml = `
                        <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop-blur" id="confirmation-modal">
                            <div class="bg-gray-900/90 rounded-xl p-6 w-full max-w-sm border border-purple-700 shadow-2xl shadow-purple-900/70 text-center">
                                
                                <!-- Иконка галочки -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto success-checkmark-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                </svg>
                                
                                <!-- Текст "Success!" -->
                                <h3 class="text-3xl font-extrabold mb-2 uppercase" style="color: #00ffff; text-shadow: 0 0 5px #00ffff, 0 0 10px #00cccc;">
                                    Success!
                                </h3>
                                
                                <!-- Текст "Check your TikTok account." -->
                                <p class="text-lg text-gray-300 mb-6 font-semibold tracking-wide">
                                    Check your TikTok account.
                                </p>
                                
                                <!-- Кнопка "Awesome!" -->
                                <button onclick="closeModal('confirmation-modal')"
                                        class="neon-button w-full py-3 rounded-xl bg-orange-600 text-white font-bold uppercase text-xl hover:bg-orange-500">
                                    Awesome!
                                </button>
                            </div>
                        </div>
                    `;
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = modalHtml;
                    document.body.appendChild(tempDiv.firstElementChild);
                };

                // 4. Вспомогательное модальное окно для ошибки
                const showErrorModal = (message) => {
                    const modalHtml = `
                        <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop-blur" id="error-modal">
                            <div class="bg-gray-900/90 rounded-xl p-6 w-full max-w-sm border border-purple-700 shadow-2xl shadow-purple-900/70 text-center">
                                <h3 class="text-2xl neon-title mb-4 pb-2 text-red-400">Ошибка ввода!</h3>
                                <p class="text-gray-300 mb-6">${message}</p>
                                <button onclick="closeModal('error-modal')"
                                        class="neon-button w-full py-3 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500">
                                    ОК
                                </button>
                            </div>
                        </div>
                    `;
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = modalHtml;
                    document.body.appendChild(tempDiv.firstElementChild);
                };
                
                // Основной обработчик нажатия на "Get Gifts"
                const handleGetGiftsClick = () => {
                    if (totalItems === 0) {
                        showEmptyCartModal();
                    } else {
                        showUsernameModal();
                    }
                };

                // Инициализация корзины при загрузке
                document.addEventListener('DOMContentLoaded', renderCartTotal);
                
                // Также настраиваем пересчет размера канваса при изменении размера окна
                window.addEventListener('resize', () => {
                    if (confettiCanvas && confettiCanvas.style.display !== 'none') {
                        confettiCanvas.width = window.innerWidth;
                        confettiCanvas.height = window.innerHeight;
                    }
                });
                
            </script>

            <!-- 1. TikTok Universe (Обновлено) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/8f471afbcebfda3841a6cc515e381f58~tplv-obj.webp" 
                         alt="TikTok Universe Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[TikTok Universe Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">TikTok Universe</h3>
                <div id="controls-TikTok-Universe" class="w-full h-10">
                    <button 
                        onclick="handleAdd('TikTok Universe')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>

            <!-- 2. Pegasus (Обновлено) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/resource/f600a2495ab5d250e7da2066484a9383.png~tplv-obj.webp" 
                         alt="Pegasus Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Pegasus Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Pegasus</h3>
                <div id="controls-Pegasus" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Pegasus')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>

            <!-- 3. Valerian's Oath (Обновлено) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/alisg/webcast-sg/resource/27408e0429e288fc735e9f010da9fcf3.png~tplv-obj.webp" 
                         alt="Valerian's Oath Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Valerian\'s Oath Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Valerian's Oath</h3>
                <div id="controls-Valerian's-Oath" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Valerian\'s Oath')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>

            <!-- 4. King of Legends (Обновлено) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/alisg/webcast-sg/resource/3790b60a52697daa138bf8d0ec27242f.png~tplv-obj.webp" 
                         alt="King of Legends Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[King of Legends Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">King of Legends</h3>
                <div id="controls-King-of-Legends" class="w-full h-10">
                    <button 
                        onclick="handleAdd('King of Legends')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>

            <!-- 5. Fire Phoenix (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/resource/bfb8425a7e8fa03f9fec05a973a4a506.png~tplv-obj.webp" 
                         alt="Fire Phoenix Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Fire Phoenix Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Fire Phoenix</h3>
                <div id="controls-Fire-Phoenix" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Fire Phoenix')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 6. Thunder Falcon (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/26f3fbcda383e6093a19b8e7351a164c~tplv-obj.webp" 
                         alt="Thunder Falcon Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Thunder Falcon Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Thunder Falcon</h3>
                <div id="controls-Thunder-Falcon" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Thunder Falcon')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 7. TikTok Stars (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/b1667c891ed39fd68ba7252fff7a1e7c~tplv-obj.webp" 
                         alt="TikTok Stars Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[TikTok Stars Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">TikTok Stars</h3>
                <div id="controls-TikTok-Stars" class="w-full h-10">
                    <button 
                        onclick="handleAdd('TikTok Stars')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 8. TikTok Universe+ (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/b13105782e8bf8fbefaa83b7af413cee~tplv-obj.webp" 
                         alt="TikTok Universe+ Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[TikTok Universe+ Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">TikTok Universe+</h3>
                <div id="controls-TikTok-Universe+" class="w-full h-10">
                    <button 
                        onclick="handleAdd('TikTok Universe+')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 9. Zeus (Обновлено) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/resource/01793f9afe15f5037a9dc10435c37c85.png~tplv-obj.webp" 
                         alt="Zeus Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Zeus Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Zeus</h3>
                <div id="controls-Zeus" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Zeus')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 10. Leon and Lion (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/a291aedacf27d22c3fd2d83575d2bee9~tplv-obj.webp" 
                         alt="Leon and Lion Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Leon and Lion Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Leon and Lion</h3>
                <div id="controls-Leon-and-Lion" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Leon and Lion')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 11. Dragon Flame (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/89b4d1d93c1cc614e3a0903ac7a94e0c~tplv-obj.webp" 
                         alt="Dragon Flame Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Dragon Flame Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Dragon Flame</h3>
                <div id="controls-Dragon-Flame" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Dragon Flame')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>
            
            <!-- 12. Adam’s Dream (Без изменений) -->
            <div class="bg-gray-900/70 backdrop-blur-sm rounded-xl overflow-hidden shadow-2xl p-2 flex flex-col items-center border border-purple-800/50">
                <div class="gift-image-placeholder w-full aspect-square rounded-lg mb-3 p-3">
                    <img src="https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/9a586391fbb1e21621c4203e5563a9e0~tplv-obj.webp" 
                         alt="Adam’s Dream Image" 
                         class="gift-image rounded-lg"
                         onerror="this.onerror=null; this.parentElement.innerHTML = '<span>[Adam’s Dream Image]</span>';">
                </div>
                <h3 class="gift-name-neon flex-grow font-bold text-center mb-3">Adam’s Dream</h3>
                <div id="controls-Adam’s-Dream" class="w-full h-10">
                    <button 
                        onclick="handleAdd('Adam’s Dream')"
                        class="neon-button w-full py-2.5 rounded-xl bg-orange-600 text-white font-bold uppercase text-lg hover:bg-orange-500 focus:outline-none focus:ring-4 focus:ring-orange-600/50">
                        Add
                    </button>
                </div>
            </div>

            <!-- Пустой div для корректного отступа над фиксированным футером -->
            <div class="h-28 col-span-2"></div> 

        </main>

    </div>

    <!-- Фиксированный футер (корзина) - ОБНОВЛЕН Z-INDEX И ONCLICK -->
    <footer class="fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-sm border-t border-purple-800/50 shadow-2xl p-4 z-50" id="app-footer">
        <div class="max-w-xl mx-auto flex justify-center items-center space-x-4">
            
            <!-- НОВАЯ ИКОНКА С БЕЙДЖЕМ -->
            <div class="flex items-center justify-center p-3 rounded-xl flex-shrink-0 relative">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 neon-bag-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                <!-- Бейдж для отображения количества товаров. Изначально добавляем класс is-empty для скрытия -->
                <span id="total-item-count" class="cart-badge is-empty">0</span> 
            </div>
            
            <!-- Кнопка "Get Gifts" - ИСПРАВЛЕНО -->
            <button onclick="handleGetGiftsClick()" class="neon-button py-3 rounded-xl bg-orange-600 text-white font-extrabold text-xl uppercase tracking-wider hover:bg-orange-500 transition duration-300 flex-grow">
                Get Gifts
            </button>

        </div>
    </footer>

    <!-- Временное сообщение (убрано из логики) -->
    <div id="message-box" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white p-3 rounded-lg shadow-xl z-50 transition duration-300 ease-in-out">
        
    </div>

</body>
</html>
